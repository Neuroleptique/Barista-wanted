<%- include('partials/header') -%>
<div class="container mx-auto relative md:max-w-4xl">

  <h1 class="text-center text-primary text-2xl md:text-4xl">Hey <strong><%= user.userName %></strong>, ready to make coffee and get paid?</h1>

  <!-- Search area -->

  <!-- Active shifts display section -->
  <h2 class="text-center text-secondary text-2xl font-bold pt-8 pb-3">Active needs</h2>
  <section class="overflow-x-auto">
    <table class="table table-compact w-full">
      <thead>
        <tr>
          <th scope="col">Date</th>
          <th scope="col">Location</th>
          <th scope="col">time</th>
          <th scope="col">Wage</th>
          <th scope="col">action</th>
        </tr>
      </thead>

      <% for(let i = 0; i < activeShift.length; i++) { %>       

          <tr data-id="<%= activeShift[i]._id %>">
            <th scope="row" class="text-sm">
              <%= new Date(activeShift[i].date).toDateString() %>
            </th>

            <!-- Show clickable cafe name -->
            <td>
              <% let cafeInfo = cafe.filter(coffeeShop => coffeeShop.userName == activeShift[i].cafeUserName )[0] %>

              <label for="<%= `${i}-${activeShift[i].cafeUserName}` %>" class="btn btn-secondary btn-sm md:btn-md"><%= activeShift[i].cafeName %></label>
              
              <!-- Popup box to display cafe info -->              
              <input type="checkbox" id="<%= `${i}-${activeShift[i].cafeUserName}` %>" class="modal-toggle" />
              <div class="modal">
                <div class="modal-box">
                  <h2 class="text-xl font-bold"><%= cafeInfo.cafeName %></h2>
                  <% if(cafeInfo.more){ %>
                    <span class="inline-block py-4">About us: <%= cafeInfo.more %></span>
                  <% } %>
                  <div class="py-6">
                  <% if(activeShift[i].location) { %>
                    <a class="btn btn-secondary btn-outline px-2" href="https://www.google.com/maps/place/?q=place_id:<%= activeShift[i].location.place_id %>" target="_blank">
                      <i class="fa-regular fa-map fa-2xl"></i>
                    </a>
                  <% } %>
                  <% if (cafeInfo.ig) { %>
                    <a class="btn btn-secondary btn-outline px-2" href="https://www.instagram.com/<%= cafeInfo.ig %>" target="_blank">
                      <i class="fa fa-brands fa-instagram fa-2xl"></i>
                    </a>
                  </div>
                  <% } %>
                  <div class="modal-action">
                    <label for="<%= `${i}-${activeShift[i].cafeUserName}` %>" class="btn">Close</label>
                  </div>
                </div>
              </div>
            </td>
            <td><%= `${activeShift[i].start_time} - ${activeShift[i].end_time}` %></td>
            <td><%= activeShift[i].wage %>$/h <%= activeShift[i].tips ? '+tips' : `(no tips)` %></td>
            <td>
              <% if (activeShift[i].availability.includes(user.userName)) { %>
                  <button type="button" class="not-available btn btn-secondary tooltip" data-tip="not available">
                    <i class="fa-regular fa-circle-xmark"></i>
                  </button>
              <% } else { %>
                  <button type="button" class="available btn btn-info tooltip" data-tip="I'm available">
                    <i class="fa-solid fa-thumbs-up fa-bounce"></i>
                  </button>
              <% } %>
            </td>
          </tr>
        <% } %>

      <% if (activeShift.length == 0 ) { %>
          <tr>
            <th colspan="5" class="text-center">There is no active shift</th>
          </tr>        
      <% } %>           
    </table>
  </section>

  <!-- Past shifts display section -->
  <h2 class="text-center text-secondary text-2xl font-bold pt-8 pb-3">Fulfilled or Past shifts</h2>
  <section class="overflow-x-auto">
    <table class="table table-compact w-full">
      <thead>
        <tr>
          <th scope="col">Date</th>
          <th scope="col">Location</th>
          <th scope="col">time</th>
          <th scope="col">Wage</th>
          <th scope="col">action</th>
        </tr>
      </thead>

      <% for(let i = 0; i < pastShift.length; i++) { %>       

          <tr data-id="<%= pastShift[i]._id %>">
            <th scope="row" class="text-sm">
              <%= new Date(pastShift[i].date).toDateString() %>
            </th>

            <!-- Show clickable cafe name -->
            <td>
              <% let cafeInfo = cafe.filter(coffeeShop => coffeeShop.userName == pastShift[i].cafeUserName )[0] %>

              <label for="<%= `${i}-${pastShift[i].cafeUserName}` %>" class="btn btn-secondary btn-sm md:btn-md"><%= pastShift[i].cafeName %></label>
              
              <!-- Popup box to display cafe info -->              
              <input type="checkbox" id="<%= `${i}-${pastShift[i].cafeUserName}` %>" class="modal-toggle" />
              <div class="modal">
                <div class="modal-box">
                  <h2 class="text-xl font-bold"><%= cafeInfo.cafeName %></h2>
                  <% if(cafeInfo.more){ %>
                    <span class="inline-block py-4">About us: <%= cafeInfo.more %></span>
                  <% } %>
                  <div class="py-6">
                  <% if(pastShift[i].location) { %>
                    <a class="btn btn-secondary btn-outline px-2" href="https://www.google.com/maps/place/?q=place_id:<%= pastShift[i].location.place_id %>" target="_blank">
                      <i class="fa-regular fa-map fa-2xl"></i>
                    </a>
                  <% } %>
                  <% if (cafeInfo.ig) { %>
                    <a class="btn btn-secondary btn-outline px-2" href="https://www.instagram.com/<%= cafeInfo.ig %>" target="_blank">
                      <i class="fa fa-brands fa-instagram fa-2xl"></i>
                    </a>
                  </div>
                  <% } %>
                  <div class="modal-action">
                    <label for="<%= `${i}-${pastShift[i].cafeUserName}` %>" class="btn">Close</label>
                  </div>
                </div>
              </div>
            </td>
            <td><%= `${pastShift[i].start_time} - ${pastShift[i].end_time}` %></td>
            <td><%= pastShift[i].wage %>$/h <%= pastShift[i].tips ? '+tips' : `(no tips)` %></td>
            <td>
              <% if (pastShift[i].availability.includes(user.userName)) { %>
                  <button type="button" class="not-available btn btn-secondary tooltip" data-tip="remove">
                    <i class="fa-regular fa-circle-xmark"></i>
                  </button>
              <% } else { %>
                  <button type="button" class="available btn btn-info tooltip" data-tip="I'm available">
                    <i class="fa-solid fa-thumbs-up fa-bounce"></i>
                  </button>
              <% } %>
            </td>
          </tr>
        <% } %>

      <% if (pastShift.length == 0 ) { %>
          <tr>
            <th colspan="5" class="text-center">There is no past shift</th>
          </tr>        
      <% } %>           
    </table>
  </section>
</div>
<%- include('partials/footer') -%>